{"version":3,"file":"schema.js","sourceRoot":"","sources":["../../../../lib/util/http/cache/schema.ts"],"names":[],"mappings":";;;AAAA,6BAAwB;AAExB,MAAM,gBAAgB,GACpB,0DAA0D,CAAC;AAEhD,QAAA,eAAe,GAAG,OAAC;KAC7B,MAAM,CAAC;IACN,iEAAiE;IACjE,SAAS,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IAChC,SAAS,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;CACjC,CAAC;KACD,WAAW,EAAE;KACb,SAAS,CAAC,CAAC,IAAI,EAAE,EAAE;IAClB,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;QACnB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;QAChC,OAAO,IAAI,CAAC,SAAS,CAAC;IACxB,CAAC;IACD,OAAO,IAAI,CAAC;AACd,CAAC,CAAC;KACD,IAAI,CACH,OAAC;KACE,MAAM,CAAC;IACN,IAAI,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IAC3B,YAAY,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IACnC,YAAY,EAAE,OAAC,CAAC,OAAO,EAAE;IACzB,SAAS,EAAE,OAAC,CAAC,MAAM,EAAE;CACtB,CAAC;KACD,MAAM,CACL,CAAC,EAAE,IAAI,EAAE,YAAY,EAAE,EAAE,EAAE,CAAC,IAAI,IAAI,YAAY,EAChD,gBAAgB,CACjB,CACJ;KACA,QAAQ,EAAE;KACV,KAAK,CAAC,IAAI,CAAC,CAAC","sourcesContent":["import { z } from 'zod';\n\nconst invalidFieldsMsg =\n  'Cache object should have `etag` or `lastModified` fields';\n\nexport const HttpCacheSchema = z\n  .object({\n    // TODO: remove this migration part during the Christmas eve 2024\n    timeStamp: z.string().optional(),\n    timestamp: z.string().optional(),\n  })\n  .passthrough()\n  .transform((data) => {\n    if (data.timeStamp) {\n      data.timestamp = data.timeStamp;\n      delete data.timeStamp;\n    }\n    return data;\n  })\n  .pipe(\n    z\n      .object({\n        etag: z.string().optional(),\n        lastModified: z.string().optional(),\n        httpResponse: z.unknown(),\n        timestamp: z.string(),\n      })\n      .refine(\n        ({ etag, lastModified }) => etag ?? lastModified,\n        invalidFieldsMsg,\n      ),\n  )\n  .nullable()\n  .catch(null);\n"]}