{"version":3,"file":"extract.js","sourceRoot":"","sources":["../../../../lib/modules/manager/cloudbuild/extract.ts"],"names":[],"mappings":";;;;AAAA,kEAAkC;AAClC,4CAAyC;AACzC,6CAAqD;AACrD,mDAA+C;AAG/C,SAAgB,kBAAkB,CAChC,OAAe,EACf,WAAoB;IAEpB,MAAM,IAAI,GAAwB,EAAE,CAAC;IACrC,IAAI,CAAC;QACH,kBAAkB;QAClB,MAAM,GAAG,GAAQ,IAAA,sBAAe,EAAC,OAAO,CAAC,CAAC;QAC1C,IAAI,GAAG,EAAE,KAAK,IAAI,YAAE,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC;YACtC,KAAK,MAAM,IAAI,IAAI,GAAG,CAAC,KAAK,EAAE,CAAC;gBAC7B,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;oBACd,MAAM,GAAG,GAAG,IAAA,gBAAM,EAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBAC9B,eAAM,CAAC,KAAK,CACV;wBACE,OAAO,EAAE,GAAG,CAAC,OAAO;wBACpB,YAAY,EAAE,GAAG,CAAC,YAAY;wBAC9B,aAAa,EAAE,GAAG,CAAC,aAAa;qBACjC,EACD,0BAA0B,CAC3B,CAAC;oBAEF,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBACjB,CAAC;YACH,CAAC;QACH,CAAC;IACH,CAAC;IAAC,OAAO,GAAG,EAAE,0BAA0B,CAAC,CAAC;QACxC,IAAI,GAAG,CAAC,KAAK,EAAE,UAAU,CAAC,gBAAgB,CAAC,EAAE,CAAC;YAC5C,eAAM,CAAC,KAAK,CACV,EAAE,GAAG,EAAE,WAAW,EAAE,EACpB,gFAAgF,CACjF,CAAC;QACJ,CAAC;aAAM,CAAC;YACN,eAAM,CAAC,KAAK,CACV,EAAE,GAAG,EAAE,WAAW,EAAE,EACpB,uEAAuE,CACxE,CAAC;QACJ,CAAC;IACH,CAAC;IACD,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;QACjB,OAAO,IAAI,CAAC;IACd,CAAC;IACD,OAAO,EAAE,IAAI,EAAE,CAAC;AAClB,CAAC;AA1CD,gDA0CC","sourcesContent":["import is from '@sindresorhus/is';\nimport { logger } from '../../../logger';\nimport { parseSingleYaml } from '../../../util/yaml';\nimport { getDep } from '../dockerfile/extract';\nimport type { PackageDependency, PackageFileContent } from '../types';\n\nexport function extractPackageFile(\n  content: string,\n  packageFile?: string,\n): PackageFileContent | null {\n  const deps: PackageDependency[] = [];\n  try {\n    // TODO: fix types\n    const doc: any = parseSingleYaml(content);\n    if (doc?.steps && is.array(doc.steps)) {\n      for (const step of doc.steps) {\n        if (step.name) {\n          const dep = getDep(step.name);\n          logger.trace(\n            {\n              depName: dep.depName,\n              currentValue: dep.currentValue,\n              currentDigest: dep.currentDigest,\n            },\n            'Cloud Build docker image',\n          );\n\n          deps.push(dep);\n        }\n      }\n    }\n  } catch (err) /* istanbul ignore next */ {\n    if (err.stack?.startsWith('YAMLException:')) {\n      logger.debug(\n        { err, packageFile },\n        'YAML exception extracting Docker images from a Cloud Build configuration file.',\n      );\n    } else {\n      logger.debug(\n        { err, packageFile },\n        'Error extracting Docker images from a Cloud Build configuration file.',\n      );\n    }\n  }\n  if (!deps.length) {\n    return null;\n  }\n  return { deps };\n}\n"]}