{"version":3,"file":"current.js","sourceRoot":"","sources":["../../../../../lib/workers/repository/process/lookup/current.ts"],"names":[],"mappings":";;;;AAAA,kEAAkC;AAClC,+CAA4C;AAE5C,kDAA+C;AAE/C,SAAgB,iBAAiB,CAC/B,YAAoB,EACpB,aAAqB,EACrB,UAAyB,EACzB,aAAqB,EACrB,aAAqB,EACrB,WAAqB;IAErB,qBAAqB;IACrB,IAAI,CAAC,YAAE,CAAC,MAAM,CAAC,YAAY,CAAC,EAAE,CAAC;QAC7B,OAAO,IAAI,CAAC;IACd,CAAC;IACD,eAAM,CAAC,KAAK,CAAC,gBAAgB,YAAY,WAAW,CAAC,CAAC;IACtD,IAAI,WAAW,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE,CAAC;QACvC,OAAO,YAAY,CAAC;IACtB,CAAC;IACD,IAAI,WAAW,GAAG,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CACzC,UAAU,CAAC,OAAO,CAAC,CAAC,EAAE,YAAY,CAAC,CACpC,CAAC;IACF,IAAI,WAAW,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;QAC7B,OAAO,WAAW,CAAC,CAAC,CAAC,CAAC;IACxB,CAAC;IACD,IAAI,aAAa,IAAI,UAAU,CAAC,OAAO,CAAC,aAAa,EAAE,YAAY,CAAC,EAAE,CAAC;QACrE,WAAW,GAAG,WAAW,CAAC,MAAM,CAC9B,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,EAAE,aAAa,CAAC,CACnD,CAAC;IACJ,CAAC;IACD,IAAI,aAAa,KAAK,KAAK,EAAE,CAAC;QAC5B,OAAO,CACL,aAAa;YACb,UAAU,CAAC,oBAAoB,CAAC,WAAW,EAAE,YAAY,CAAC,CAC3D,CAAC;IACJ,CAAC;IACD,IAAI,aAAa,KAAK,MAAM,EAAE,CAAC;QAC7B,8CAA8C;QAC9C,OAAO,UAAU,CAAC,oBAAoB,CAAC,WAAW,EAAE,YAAY,CAAC,CAAC;IACpE,CAAC;IACD,+CAA+C;IAC/C,MAAM,iBAAiB,GAAG,UAAU,CAAC,oBAAoB,CACvD,WAAW,EACX,YAAY,CACb,CAAC;IACF,IAAI,iBAAiB,EAAE,CAAC;QACtB,OAAO,iBAAiB,CAAC;IAC3B,CAAC;IAED,IAAI,UAAU,CAAC,SAAS,CAAC,YAAY,CAAC,EAAE,CAAC;QACvC,OAAO,YAAY,CAAC;IACtB,CAAC;IACD,IAAI,UAAU,CAAC,eAAe,CAAC,YAAY,CAAC,EAAE,CAAC;QAC7C,OAAO,YAAY,CAAC,OAAO,CAAC,IAAA,aAAK,EAAC,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;IACtD,CAAC;IAED,OAAO,IAAI,CAAC;AACd,CAAC;AAtDD,8CAsDC","sourcesContent":["import is from '@sindresorhus/is';\nimport { logger } from '../../../../logger';\nimport type { VersioningApi } from '../../../../modules/versioning/types';\nimport { regEx } from '../../../../util/regex';\n\nexport function getCurrentVersion(\n  currentValue: string,\n  lockedVersion: string,\n  versioning: VersioningApi,\n  rangeStrategy: string,\n  latestVersion: string,\n  allVersions: string[],\n): string | null {\n  // istanbul ignore if\n  if (!is.string(currentValue)) {\n    return null;\n  }\n  logger.trace(`currentValue ${currentValue} is range`);\n  if (allVersions.includes(currentValue)) {\n    return currentValue;\n  }\n  let useVersions = allVersions.filter((v) =>\n    versioning.matches(v, currentValue),\n  );\n  if (useVersions.length === 1) {\n    return useVersions[0];\n  }\n  if (latestVersion && versioning.matches(latestVersion, currentValue)) {\n    useVersions = useVersions.filter(\n      (v) => !versioning.isGreaterThan(v, latestVersion),\n    );\n  }\n  if (rangeStrategy === 'pin') {\n    return (\n      lockedVersion ||\n      versioning.getSatisfyingVersion(useVersions, currentValue)\n    );\n  }\n  if (rangeStrategy === 'bump') {\n    // Use the lowest version in the current range\n    return versioning.minSatisfyingVersion(useVersions, currentValue);\n  }\n  // Use the highest version in the current range\n  const satisfyingVersion = versioning.getSatisfyingVersion(\n    useVersions,\n    currentValue,\n  );\n  if (satisfyingVersion) {\n    return satisfyingVersion;\n  }\n\n  if (versioning.isVersion(currentValue)) {\n    return currentValue;\n  }\n  if (versioning.isSingleVersion(currentValue)) {\n    return currentValue.replace(regEx(/=/g), '').trim();\n  }\n\n  return null;\n}\n"]}